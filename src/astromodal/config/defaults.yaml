# Default configuration for astromodal package

# File paths and templates
paths:
  # Datacube parquet files
  datacube_template: "/home/astrodados4/downloads/hypercube/datacube_{field}.parquet"

  # Token output templates
  image_tokens_template: "outputs/image_tokens/datacube_{field}_tokens.npz"
  scalar_tokens_template: "outputs/scalar_tokens/datacube_{field}_scalar_tokens.npz"
  spectrum_tokens_template: "outputs/spectrum_tokens/datacube_{field}_spectrum_tokens.npz"

  # Image latents
  image_latents_template: "outputs/image_latents/datacube_{field}_latents.npz"

  # Tokenizer configs
  scalar_tokenizer_config: "scalar_tokenizers/scalar_tokenizer_config.npz"
  spectrum_tokenizer_config: "spectrum_tokenizers/spectrum_tokenizer_config.npz"
  image_autoencoder: "image_tokenizers/autoencoder_splus_cuts.pt"

  # Codebooks
  image_codebook: "image_tokenizers/codebook_kmeans_2048.joblib"

  # Output directories
  output_dir: "runs_tokens_transformer"

# Data filtering and preprocessing
data:
  mag_filter:
    column: "mag_pstotal_r"
    min: 14.0
    max: 22.0
  magerr_max: 2.0

  # Bands for S-PLUS
  splus_bands:
    - "u"
    - "i"
    - "r"
    - "g"
    - "z"
    - "j0378"
    - "j0395"
    - "j0410"
    - "j0430"
    - "j0515"
    - "j0660"
    - "j0861"

# Tokenizer configurations
tokenizers:
  scalar:
    n_bins: 1024
    max_values_per_col: 2000000
    max_values_per_file_per_col: 100000

  spectrum:
    codebook_size: 2048
    groups:
      - "gaiaxp_bp"
      - "gaiaxp_rp"
      - "desi_b"
      - "desi_r"
      - "desi_z"

  image:
    cutout_size: 96
    latent_dim: 2
    codebook_size: 2048
    bands:
      - "F378"
      - "F395"
      - "F410"
      - "F430"
      - "F515"
      - "F660"
      - "F861"
      - "U"
      - "G"
      - "R"
      - "I"
      - "Z"

# Vocabulary sizes
vocab:
  image: 2048
  scalar: 56320  # 55 columns Ã— 1024 bins
  spectrum: 2048

# Sequence limits
sequences:
  max_image_tokens: 576  # 24 * 24
  max_scalar_tokens: 512
  max_spec_tokens_per_group: 512
  max_seq_len: 2048

# Model architecture
model:
  d_model: 768
  n_layers: 12
  n_heads: 12
  d_ff: 3072
  dropout: 0.1

# Training configuration
training:
  seed: 0
  batch_size: 16
  epochs: 5
  learning_rate: 0.0002
  weight_decay: 0.05
  warmup_steps: 2000
  grad_clip: 1.0
  grad_accum_steps: 1

  # DataLoader settings
  num_workers: 0  # Set to 0 for debugging, increase to 4+ for production
  pin_memory: true
  persistent_workers: true
  prefetch_factor: 2

  # Logging and checkpointing
  log_every: 50
  save_every_steps: 5000

  # Meaningful loss settings
  meaningful_loss:
    enabled: true
    sample_k_per_modality: 64
    weight_image: 0.1
    weight_scalar: 0.1
    weight_spectrum: 0.1
